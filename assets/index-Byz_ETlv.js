import{c as re,a as I,g as h,E as _e,$ as Ae,z as Pe,T as Te,C as Fe,l as ze,D as Xe,b as Ee,d as We,k as He}from"./genStyleUtils-HeKioqsF.js";import{u as Ke}from"./pick-attrs-C9oI0e2o.js";import{d as m,i as ue,e as s,s as de,f as V,u as ce,h as pe,p as ve,j as G,k as J,b as o,q as w,v as B,G as fe,C as ge,t as Me,l as $,m as je,g as Le,x as Oe,an as qe,ao as Ve}from"./index-BhYHN2x7.js";import{B as me}from"./index-BE-87L20.js";import{a as Ge,l as Je}from"./index-B5Kn6piB.js";import{m as Qe}from"./useMergedState-BA_5yoZw.js";import{I as Ue}from"./index-4VzvcerL.js";import{F as Ye}from"./index-Df3C9YKa.js";const he=Symbol("SenderHeaderContext"),L=de(),Ze=e=>{ve(he,e),V(e,()=>{L.value=ce(e),pe(L)},{immediate:!0,deep:!0})},el=()=>ue(he,s(()=>L.value||{})),ll=m({props:{value:re()},setup(e,{slots:l}){return Ze(s(()=>e.value)),()=>{var t;return(t=l.default)==null?void 0:t.call(l)}}}),ye=Symbol("ActionButtonContext"),O=de(),nl=e=>{ve(ye,e),V(e,()=>{O.value=ce(e),pe(O)},{immediate:!0,deep:!0})},Q=()=>ue(ye,s(()=>O.value||{})),ol=m({props:{value:re()},setup(e,{slots:l}){return nl(s(()=>e.value)),()=>{var t;return(t=l.default)==null?void 0:t.call(l)}}}),E=m({name:"AXSenderActionButton",__name:"index",props:{action:{},prefixCls:{},type:{default:"text"},htmlType:{},shape:{},size:{},loading:{type:[Boolean,Object]},disabled:{type:Boolean,default:void 0},ghost:{type:Boolean},block:{type:Boolean},danger:{type:Boolean},icon:{},href:{},target:{},title:{},onClick:{},onMousedown:{},audioIcon:{},audioDisabledIcon:{},audioRecordingIcon:{}},setup(e){const l=I(e,["action","type","disabled","onClick"]);G(e,"disabled");const t=J(),a=Q(),p=s(()=>{var d;const i=a.value.disabled,g=(d=a.value)==null?void 0:d[`${e.action}Disabled`];return e.disabled??i??g}),r=s(()=>a.value.prefixCls);return()=>o(me,w({type:e.type},l,{onClick:d=>{var i,g;p.value||((g=(i=a.value)==null?void 0:i[e.action])==null||g.call(i),e.onClick&&!Array.isArray(e.onClick)&&e.onClick(d))},class:h(r.value,{[`${r.value}-disabled`]:p.value})}),{icon:()=>t.default()})}}),al=m({name:"AXSenderClearButton",__name:"ClearButton",props:B({prefixCls:null,type:null,htmlType:null,shape:null,size:null,loading:null,disabled:null,ghost:null,block:null,danger:null,icon:null,href:null,target:null,title:null,onClick:null,onMousedown:null,audioIcon:null,audioDisabledIcon:null,audioRecordingIcon:null},{disabled:void 0}),setup(e){const l=I(e,["disabled"]);return()=>o(E,w({disabled:e.disabled},l,{action:"onClear"}),{default:()=>[o(_e,null,null)]})}}),tl=m({name:"AXSenderStopLoading",__name:"StopLoading",props:{className:null},setup(e){const l=e;return()=>o("svg",{color:"currentColor",viewBox:"0 0 1000 1000",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",class:l.className},[o("title",null,[fe("Stop Loading")]),o("rect",{fill:"currentColor",height:"250",rx:"24",ry:"24",width:"250",x:"375",y:"375"},null),o("circle",{cx:"500",cy:"500",fill:"none",r:"450",stroke:"currentColor","stroke-width":"100",opacity:"0.45"},null),o("circle",{cx:"500",cy:"500",fill:"none",r:"450",stroke:"currentColor","stroke-width":"100","stroke-dasharray":"600 9999999"},[o("animateTransform",{attributeName:"transform",dur:"1s",from:"0 500 500",repeatCount:"indefinite",to:"360 500 500",type:"rotate"},null)])])}}),ae=m({name:"AXSenderLoadingButton",__name:"LoadingButton",props:B({prefixCls:null,type:null,htmlType:null,shape:null,size:null,loading:null,disabled:null,ghost:null,block:null,danger:null,icon:null,href:null,target:null,title:null,onClick:null,onMousedown:null,audioIcon:null,audioDisabledIcon:null,audioRecordingIcon:null},{type:"primary",shape:"circle",icon:void 0,disabled:void 0}),setup(e){const l=I(e,["type","shape","icon","disabled"]),t=Q(),{token:a}=ge.useToken();return()=>o(E,w({type:e.type,disabled:e.disabled,shape:e.shape,icon:e.icon},l,{style:{backgroundColor:"transparent",color:a.value.colorPrimary},class:h(`${t.value.prefixCls}-loading-button`),action:"onCancel"}),{default:()=>[o(tl,{className:`${t.value.prefixCls}-loading-icon`},null)]})}}),te=m({name:"AXSenderLoadingButton",__name:"SendButton",props:B({prefixCls:null,type:null,htmlType:null,shape:null,size:null,loading:null,disabled:null,ghost:null,block:null,danger:null,icon:null,href:null,target:null,title:null,onClick:null,onMousedown:null,audioIcon:null,audioDisabledIcon:null,audioRecordingIcon:null},{type:"primary",shape:"circle",disabled:void 0}),setup(e){const l=I(e,["type","shape","disabled"]);return()=>o(E,w({type:e.type,shape:e.shape,disabled:e.disabled},l,{action:"onSend"}),{default:()=>[o(Ae,null,null)]})}}),R=1e3,N=4,T=140,F=250,ie=500,z=.8,il=m({name:"AXSenderRecordingIcon",__name:"RecordingIcon",props:{className:null,audioIcon:null,audioDisabledIcon:null,audioRecordingIcon:null},setup(e){const l=T/2;return()=>o("svg",{color:"currentColor",viewBox:`0 0 ${R} ${R}`,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",class:e.className},[o("title",null,[fe("Speech Recording")]),Array.from({length:N}).map((t,a)=>{const p=(R-T*N)/(N-1),r=a*(p+T),d=R/2-F/2,i=R/2-ie/2;return o("rect",{fill:"currentColor",rx:l,ry:l,height:F,width:T,x:r,y:d,key:a},[o("animate",{attributeName:"height",values:`${F}; ${ie}; ${F}`,keyTimes:"0; 0.5; 1",dur:`${z}s`,begin:`${z/N*a}s`,repeatCount:"indefinite"},null),o("animate",{attributeName:"y",values:`${d}; ${i}; ${d}`,keyTimes:"0; 0.5; 1",dur:`${z}s`,begin:`${z/N*a}s`,repeatCount:"indefinite"},null)])})])}}),se=m({name:"AXSenderSpeechButton",__name:"index",props:B({prefixCls:null,type:null,htmlType:null,shape:null,size:null,loading:null,disabled:null,ghost:null,block:null,danger:null,icon:null,href:null,target:null,title:null,onClick:null,onMousedown:null,audioIcon:null,audioDisabledIcon:null,audioRecordingIcon:null},{type:"text",disabled:void 0,audioIcon:()=>o(Te,null,null),audioDisabledIcon:()=>o(Pe,null,null),audioRecordingIcon:void 0}),setup(e){const l=I(e,["type","disabled","audioIcon","audioDisabledIcon","audioRecordingIcon"]),t=Q(),{token:a}=ge.useToken(),p=s(()=>t.value.speechRecording),r=s(()=>t.value.prefixCls),d=s(()=>{let i;return p.value?i=e.audioRecordingIcon?e.audioRecordingIcon:o(il,{className:`${r.value}-recording-icon`},null):t.value.onSpeechDisabled?i=e.audioDisabledIcon:i=e.audioIcon,i});return()=>o(E,w({type:e.type,disabled:e.disabled},l,{style:{display:"flex",justifyContent:"center",alignItems:"center",color:a.value.colorPrimary},action:"onSpeech"}),{default:()=>[d.value]})}}),sl=e=>{const{componentCls:l,calc:t}=e,a=`${l}-header`;return{[l]:{[a]:{borderBottomWidth:e.lineWidth,borderBottomStyle:"solid",borderBottomColor:e.colorBorder,"&-header":{background:e.colorFillAlter,fontSize:e.fontSize,lineHeight:e.lineHeight,paddingBlock:t(e.paddingSM).sub(e.lineWidthBold).equal(),paddingInlineStart:e.padding,paddingInlineEnd:e.paddingXS,display:"flex",borderRadius:{_skip_check_:!0,value:t(e.borderRadius).mul(2).equal()},borderBottomRightRadius:0,borderBottomLeftRadius:0,[`${a}-title`]:{flex:"auto"}},"&-content":{padding:e.padding},"&-motion":{transition:["height","border"].map(p=>`${p} ${e.motionDurationSlow}`).join(","),overflow:"hidden","&-enter-start, &-leave-active":{borderBottomColor:"transparent"},"&-hidden":{display:"none"}}}}}},rl=e=>{const{componentCls:l,padding:t,paddingSM:a,paddingXS:p,paddingXXS:r,lineWidth:d,lineWidthBold:i,calc:g}=e;return{[l]:{position:"relative",width:"100%",boxSizing:"border-box",boxShadow:`${e.boxShadowTertiary}`,transition:`background ${e.motionDurationSlow}`,borderRadius:{_skip_check_:!0,value:g(e.borderRadius).mul(2).equal()},borderColor:e.colorBorder,borderWidth:0,borderStyle:"solid","&:after":{content:'""',position:"absolute",inset:0,pointerEvents:"none",transition:`border-color ${e.motionDurationSlow}`,borderRadius:{_skip_check_:!0,value:"inherit"},borderStyle:"inherit",borderColor:"inherit",borderWidth:d},"&:focus-within":{boxShadow:`${e.boxShadowSecondary}`,borderColor:e.colorPrimary,"&:after":{borderWidth:i}},"&-disabled":{background:e.colorBgContainerDisabled},[`&${l}-rtl`]:{direction:"rtl"},[`${l}-content`]:{display:"flex",gap:p,width:"100%",paddingBlock:a,paddingInlineStart:t,paddingInlineEnd:a,boxSizing:"border-box",alignItems:"flex-end"},[`${l}-prefix`]:{flex:"none"},[`${l}-input`]:{padding:0,borderRadius:0,flex:"auto",alignSelf:"center",minHeight:"auto"},[`${l}-actions-list`]:{flex:"none",display:"flex","&-presets":{gap:e.paddingXS}},[`${l}-actions-btn`]:{"&-disabled":{opacity:.45},"&-loading-button":{padding:0,border:0},"&-loading-icon":{height:e.controlHeight,width:e.controlHeight,verticalAlign:"top"},"&-recording-icon":{height:"1.2em",width:"1.2em",verticalAlign:"top"}},[`${l}-footer`]:{paddingInlineStart:t,paddingInlineEnd:a,paddingBlockEnd:a,paddingBlockStart:r,boxSizing:"border-box"}}}},ul=()=>({}),dl=Fe("Sender",e=>{const{paddingXS:l,calc:t}=e,a=ze(e,{SenderContentMaxWidth:`calc(100% - ${Xe(t(l).add(32).equal())})`});return[rl(a),sl(a),Ge(a)]},ul);let X;!X&&typeof window<"u"&&(X=window.SpeechRecognition||window.webkitSpeechRecognition);function cl(e,l){const t=e,a=s(()=>{const c=Me(l);return typeof c=="object"?{controlledRecording:c.recording,onControlledRecordingChange:c.onRecordingChange,speechInControlled:typeof c.recording=="boolean"}:{controlledRecording:void 0,onControlledRecordingChange:void 0,speechInControlled:!1}}),p=s(()=>a.value.controlledRecording),r=a.value.onControlledRecordingChange,d=a.value.speechInControlled,i=$(null);je(()=>{if(typeof navigator<"u"&&"permissions"in navigator){let c=null;navigator.permissions.query({name:"microphone"}).then(C=>{i.value=C.state,C.onchange=function(){i.value=this.state},c=C}),Le(()=>{c&&(c.onchange=null)})}});const g=s(()=>X&&i.value!=="denied"),b=$(null),[v,k]=Qe(!1,{value:p}),y=$(!1),f=()=>{if(g.value&&!b.value){const c=new X;c.onstart=()=>{k(!0)},c.onend=()=>{k(!1)},c.onresult=C=>{var D,_,A;if(!y.value){const W=(A=(_=(D=C.results)==null?void 0:D[0])==null?void 0:_[0])==null?void 0:A.transcript;t(W)}y.value=!1},b.value=c}};return{speechPermission:g,triggerSpeech:c=>{c&&!v.value||(y.value=c,d?r==null||r(!v.value):(f(),b.value&&(v.value?(b.value.stop(),r==null||r(!1)):(b.value.start(),r==null||r(!0)))))},recording:v}}function pl(e,l){for(var t=e,a=0;a<l.length;a+=1){if(t==null)return;t=t[l[a]]}return t}const vl=m({name:"AXSender",__name:"Sender",props:B({onKeyPress:{type:Function},onFocus:null,onBlur:null,prefixCls:null,defaultValue:null,value:null,loading:{type:Boolean},placeholder:null,readOnly:{type:Boolean},submitType:{type:[String,Boolean]},disabled:{type:Boolean},onSubmit:{type:Function},onChange:{type:Function},onCancel:null,onKeyDown:{type:Function},onPaste:{type:Function},onPasteFile:{type:Function},components:null,styles:null,rootClassName:null,classNames:null,style:null,className:null,actions:{type:[Function,Boolean]},allowSpeech:null,prefix:{type:Function},footer:{type:Function},header:{type:Function},autoSize:null},{styles:()=>({}),classNames:()=>({}),submitType:"enter",actions:void 0,disabled:void 0,autoSize:()=>({maxRows:8})}),emits:["update:value"],setup(e,{expose:l,emit:t}){const a=I(e,["prefixCls","styles","classNames","className","rootClassName","style","defaultValue","value","placeholder","readOnly","submitType","onSubmit","loading","components","onCancel","onChange","actions","onKeyPress","onKeyDown","disabled","allowSpeech","prefix","footer","header","onPaste","onPasteFile","autoSize"]);G(e,"prefixCls");function p(n,u,x){return pl(n,u)||x}const r={SendButton:te,ClearButton:al,LoadingButton:ae,SpeechButton:se},d=t,i=J(),{direction:g,getPrefixCls:b}=Ee(),v=s(()=>b("sender",e.prefixCls)),k=$(null),y=$(null),f=We("sender"),c=s(()=>`${v.value}-input`),[C,D,_]=dl(v.value),A=s(()=>h(v.value,f.value.className,e.className,e.rootClassName,D.value,_,{[`${v.value}-rtl`]:g.value==="rtl",[`${v.value}-disabled`]:e.disabled})),W=s(()=>`${v.value}-actions-btn`),U=s(()=>`${v.value}-actions-list`),S=$(e.value??e.defaultValue??""),Y=n=>{S.value=n};V(()=>e.value,()=>{Y(e.value)});const H=(n,u)=>{Y(n),d("update:value",n),e.onChange&&e.onChange(n,u)},{speechPermission:be,triggerSpeech:Z,recording:Ce}=cl(n=>{H(`${S.value} ${n}`)},()=>e.allowSpeech),Se=p(e.components,["input"],Ue.TextArea),xe=s(()=>Ke(a,{attr:!0,aria:!0,data:!0})),$e=s(()=>({...xe.value,ref:y})),K=()=>{S.value&&e.onSubmit&&!e.loading&&e.onSubmit(S.value)},we=()=>{H("")},M=$(!1),ke=()=>{M.value=!0},Ie=()=>{M.value=!1},Be=n=>{const u=n.key==="Enter"&&!M.value;switch(e.submitType){case"enter":u&&!n.shiftKey&&(n.preventDefault(),K());break;case"shiftEnter":u&&n.shiftKey&&(n.preventDefault(),K());break}e.onKeyPress&&e.onKeyPress(n)},Re=n=>{var u,x;const P=(u=n.clipboardData)==null?void 0:u.files;P!=null&&P.length&&e.onPasteFile&&(e.onPasteFile(P[0],P),n.preventDefault()),(x=e.onPaste)==null||x.call(e,n)},Ne=n=>{var u,x;n.target!==((u=k.value)==null?void 0:u.querySelector(`.${c.value}`))&&n.preventDefault(),(x=y.value)==null||x.focus()},ee=s(()=>{let n=o(Ye,{class:`${U.value}-presets`},{default:()=>[e.allowSpeech&&o(se,typeof e.allowSpeech=="object"?{audioIcon:e.allowSpeech.audioIcon,audioDisabledIcon:e.allowSpeech.audioDisabledIcon,audioRecordingIcon:e.allowSpeech.audioRecordingIcon}:{},null),e.loading?o(ae,null,null):o(te,null,null)]});const u={components:r};return i.actions?n=i.actions({ori:n,info:u}):typeof e.actions=="function"?n=e.actions(n,u):(e.actions||e.actions===!1)&&(n=e.actions),n}),De=s(()=>({prefixCls:W.value,onSend:K,onSendDisabled:!S.value,onClear:we,onClearDisabled:!S.value,onCancel:e.onCancel,onCancelDisabled:!e.loading,onSpeech:()=>Z(!1),onSpeechDisabled:!be.value,speechRecording:Ce.value,disabled:e.disabled})),le=s(()=>{let n=null;const u={components:r};return i.footer?n=i.footer({info:u}):typeof e.footer=="function"?n=e.footer({components:r}):e.footer&&(n=e.footer),n}),ne=s(()=>i.header?i.header():typeof e.header=="function"?e.header():e.header),oe=s(()=>i.prefix?i.prefix():typeof e.prefix=="function"?e.prefix():e.prefix);return l({nativeElement:k.value,focus:n=>{var u;return(u=y.value)==null?void 0:u.focus(n)},blur:()=>{var n;return(n=y.value)==null?void 0:n.blur()}}),()=>C(o("div",{ref:k,class:A.value,style:{...f.value.style,...e.style}},[ne.value&&o(ll,{value:{prefixCls:v.value}},{default:()=>[ne.value]}),o(ol,{value:De.value},{default:()=>[o("div",{class:`${v.value}-content`,onMousedown:Ne},[oe.value&&o("div",{class:h(`${v.value}-prefix`,f.value.classNames.prefix,e.classNames.prefix),style:{...f.value.styles.prefix,...e.styles.prefix}},[oe.value]),o(Se,w($e.value,{disabled:e.disabled,style:{...f.value.styles.input,...e.styles.input},class:h(c.value,f.value.classNames.input,e.classNames.input),autoSize:e.autoSize,value:S.value,onChange:n=>{H(n.target.value,n),Z(!0)},onPressEnter:Be,onCompositionstart:ke,onCompositionend:Ie,onKeydown:e.onKeyDown,placeholder:e.placeholder,onPaste:Re,bordered:!1,readOnly:e.readOnly}),null),ee.value&&o("div",{class:h(U.value,f.value.classNames.actions,e.classNames.actions),style:{...f.value.styles.actions,...e.styles.actions}},[ee.value])]),le.value&&o("div",{class:h(`${v.value}-footer`,f.value.classNames.footer,e.classNames.footer),style:{...f.value.styles.footer,...e.styles.footer}},[le.value])]})]))}}),q=m({name:"AXSenderHeader",inheritAttrs:!1,__name:"SenderHeader",props:B({forceRender:{type:Boolean},open:{type:Boolean},onOpenChange:{type:Function},title:null,children:null,className:null,style:null,classNames:null,styles:null,closable:{type:Boolean}},{classNames:()=>({}),styles:()=>({})}),setup(e){G(e,"classNames");const l=J(),t=el(),a=s(()=>`${t.value.prefixCls}-header`),p=Oe();return()=>o(Je,{prefixCls:t.value.prefixCls},{default:()=>{var r;return[e.open||e.forceRender?qe(o("div",w(p,{class:h(a.value,e.className),style:{...e.style}}),[(e.closable!==!1||e.title)&&o("div",{class:h(`${a.value}-header`,e.classNames.header),style:{...e.styles.header}},[o("div",{class:`${a.value}-title`},[e.title]),e.closable!==!1&&o("div",{class:`${a.value}-close`},[o(me,{type:"text",icon:o(He,null,null),size:"small",onClick:()=>{var d;(d=e.onOpenChange)==null||d.call(e,!e.open)}},null)])]),l.default&&o("div",{class:h(`${a.value}-content`,e.classNames.content),style:{...e.styles.content}},[(r=l.default)==null?void 0:r.call(l)])]),[[Ve,e.open]]):null]}})}}),j=Object.assign(vl,{Header:q});j.install=function(e){return e.component(j.name,j),e.component(q.name,q),e};export{j as e};
